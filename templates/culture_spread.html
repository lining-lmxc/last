{% extends "base.html" %}

{% block content %}
<div class="spread-map">
    <div class="page-header">
        <h1>{{ spread_data.title }}</h1>
        <p class="period">{{ spread_data.period }}</p>
        <p class="source">数据来源：{{ spread_data.data_source }}</p>
    </div>

    <div class="map-container">
        <div id="spreadChart" style="width: 1000px;height:600px;"></div>
    </div>
    
    <div class="historical-context">
        <h2>茶文化传播历史</h2>
        <div class="timeline">
            {% for event in spread_data.historical_events %}
            <div class="timeline-item">
                <div class="timeline-icon">{{ event.year }}</div>
                <div class="timeline-content">
                    <h3>{{ event.event }}</h3>
                    <p>{{ event.impact }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    var spreadData = {{ spread_data|tojson }};
    
    var chart = echarts.init(document.getElementById('spreadChart'));
    var option = {
        title: { 
            text: '中华茶文化传播路线（7-19世纪）', 
            textStyle: { fontFamily: 'Calligraphy' }
        },
        tooltip: {
            trigger: 'item',
            formatter: function(params) {
                if (params.dataType === 'node') {
                    return `${params.data.name}<br>时代：${params.data.era}<br>角色：${params.data.role}`;
                }
                return '';
            }
        },
        geo: {
            map: 'world',
            roam: true,
            itemStyle: {
                areaColor: '#e6f3e6',
                borderColor: '#7b8d6d'
            },
            emphasis: {
                itemStyle: {
                    areaColor: '#c4d8c4'
                }
            }
        },
        series: [
            {
                type: 'scatter',
                coordinateSystem: 'geo',
                data: spreadData.nodes,
                symbolSize: 10,
                label: {
                    show: true,
                    formatter: '{b}',
                    position: 'right',
                    fontFamily: 'Calligraphy'
                },
                itemStyle: {
                    color: '#4a6144'
                }
            },
            {
                type: 'lines',
                coordinateSystem: 'geo',
                data: spreadData.processed_routes,
                polyline: true,
                lineStyle: {
                    color: '#7b8d6d',
                    width: 2,
                    curveness: 0.2
                },
                effect: {
                    show: true,
                    period: 6,
                    trailLength: 0.7,
                    color: '#fff',
                    symbolSize: 3
                }
            }
        ]
    };
    chart.setOption(option);
</script>
{% endblock %}