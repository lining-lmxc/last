{% extends "base.html" %}

{% block content %}
<div class="spread-container">
    <div class="page-header">
        <h1>{{ spread_data.title }}</h1>
        <p class="period">{{ spread_data.period }}</p>
        <p class="data-source">数据来源：{{ spread_data.data_source }}</p>
    </div>

    <div class="historical-context">
        <div class="timeline-container">
            <h2>历史事件</h2>
            <div class="timeline">
                {% if spread_data.historical_events %}
                  {% for event in spread_data.historical_events %}
                  <div class="timeline-item">
                      <div class="timeline-icon">{{ event.year }}</div>
                      <div class="timeline-content">
                          <h3>{{ event.event }}</h3>
                          <p>{{ event.impact }}</p>
                      </div>
                  </div>
                  {% endfor %}
                {% else %}
                  <!-- 静态历史事件 -->
                  <div class="timeline-item">
                      <div class="timeline-icon">唐</div>
                      <div class="timeline-content">
                          <h3>陆羽《茶经》问世</h3>
                          <p>公元780年，陆羽完成《茶经》，系统总结唐代茶事</p>
                          <div class="historical-detail">
                              <p>《茶经·八之出》记载："山南以峡州上，襄州、荆州次，衡州下，金州、梁州又下。"</p>
                          </div>
                      </div>
                  </div>
                  <div class="timeline-item">
                      <div class="timeline-icon">宋</div>
                      <div class="timeline-content">
                          <h3>榷茶制度确立</h3>
                          <p>宋代实行茶叶专卖，建立官营茶园</p>
                          <div class="historical-detail">
                              <p>《宋史·食货志》："凡茶之利，官得其七，商得其三。"</p>
                          </div>
                      </div>
                  </div>
                  <div class="timeline-item">
                      <div class="timeline-icon">明</div>
                      <div class="timeline-content">
                          <h3>炒青工艺普及</h3>
                          <p>明代炒青工艺取代蒸青，奠定现代制茶基础</p>
                          <div class="historical-detail">
                              <p>《茶疏》："炒茶之器，最嫌新铁，铁腥一入，不复有香。"</p>
                          </div>
                      </div>
                  </div>
                {% endif %}
            </div>
        </div>

        <div class="price-history">
            <h2>历代茶价变迁</h2>
            <div class="price-chart">
                <div class="price-item">
                    <div class="era">唐代</div>
                    <div class="price-info">
                        <p>上等茶：每斤100文</p>
                        <p>中等茶：每斤50文</p>
                        <p>下等茶：每斤30文</p>
                    </div>
                    <div class="source">《新唐书·食货志》</div>
                </div>
                <div class="price-item">
                    <div class="era">宋代</div>
                    <div class="price-info">
                        <p>建州贡茶：每斤1000文</p>
                        <p>普通茶：每斤200文</p>
                    </div>
                    <div class="source">《宋会要辑稿》</div>
                </div>
                <div class="price-item">
                    <div class="era">明代</div>
                    <div class="price-info">
                        <p>龙井茶：每斤500文</p>
                        <p>普通茶：每斤100文</p>
                    </div>
                    <div class="source">《明史·食货志》</div>
                </div>
            </div>
        </div>
    </div>

    <div class="route-map">
        <div class="route-container">
            {% if spread_data.routes and spread_data.routes|length > 0 %}
                {% for route in spread_data.routes %}
                <div class="route-item {{ route.type|lower }}">
                    <h3>{{ route.type }}传播</h3>
                    <div class="route-path">
                        {% for point in route.path %}
                        {% set node = spread_data.nodes|selectattr('coord', 'equalto', point)|first %}
                        {% if node %}
                        <div class="node" data-info="{{ node.era }}时期{{ node.role }}">{{ node.name }}</div>
                        {% if not loop.last %}
                        <div class="arrow">→</div>
                        {% endif %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div class="route-info">
                        <p>时期：{{ route.era }}</p>
                        {% if route.goods %}
                        <p>主要商品：{{ route.goods|join('、') }}</p>
                        {% endif %}
                        {% if route.caravan %}
                        <p>运输方式：{{ route.caravan }}</p>
                        {% endif %}
                        {% if route.ship_type %}
                        <p>船只类型：{{ route.ship_type }}</p>
                        {% endif %}
                        {% if route.volume %}
                        <p>年贸易量：{{ route.volume }}担</p>
                        {% endif %}
                        {% if route.record %}
                        <p>文献记载：{{ route.record }}</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <!-- 静态路线展示 -->
                <div class="route-item land">
                    <h3>陆路传播</h3>
                    <div class="route-path">
                        <div class="node" data-info="唐代茶马古道起点，茶叶贸易中心">长安</div>
                        <div class="arrow">→</div>
                        <div class="node" data-info="丝绸之路重要节点，茶叶中转站">敦煌</div>
                        <div class="arrow">→</div>
                        <div class="node" data-info="连接中亚的贸易通道，唐代茶叶外销重要路线">西域</div>
                        <div class="arrow">→</div>
                        <div class="node" data-info="波斯商人将茶叶引入中东，形成茶马互市">波斯</div>
                    </div>
                </div>
                <div class="route-item sea">
                    <h3>海路传播</h3>
                    <div class="route-path">
                        <div class="node" data-info="宋代海上丝绸之路起点，茶叶出口重要港口">泉州</div>
                        <div class="arrow">→</div>
                        <div class="node" data-info="重要对外贸易港口，宋代茶市繁荣">广州</div>
                        <div class="arrow">→</div>
                        <div class="node" data-info="茶叶贸易中转站，形成茶文化圈">东南亚</div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="tea-ware-evolution">
        <h2>茶具演变历程</h2>
        <div class="evolution-container">
            <div class="era-section">
                <div class="era-title">唐代茶具</div>
                <div class="tea-ware-item">
                    <div class="ware-name">鎏金银茶碾</div>
                    <div class="ware-detail">
                        <p>法门寺地宫出土，用于碾碎茶饼</p>
                        <div class="historical-source">《茶经·四之器》："碾以橘木为之，次以梨、桑、桐、柘为之。"</div>
                    </div>
                </div>
                <div class="tea-ware-item">
                    <div class="ware-name">鎏金银茶罗</div>
                    <div class="ware-detail">
                        <p>用于筛分茶末，确保茶粉细腻</p>
                        <div class="historical-source">《茶经·四之器》："罗末，以合盖贮之，以则置合中。"</div>
                    </div>
                </div>
            </div>

            <div class="era-section">
                <div class="era-title">宋代茶具</div>
                <div class="tea-ware-item">
                    <div class="ware-name">建窑兔毫盏</div>
                    <div class="ware-detail">
                        <p>黑釉茶盏，适合点茶斗茶</p>
                        <div class="historical-source">《大观茶论》："盏色贵青黑，玉毫条达者为上。"</div>
                    </div>
                </div>
                <div class="tea-ware-item">
                    <div class="ware-name">茶筅</div>
                    <div class="ware-detail">
                        <p>竹制，用于击拂茶汤</p>
                        <div class="historical-source">《茶录》："茶筅以筋竹老者为之，身欲厚重，筅欲疏劲。"</div>
                    </div>
                </div>
            </div>

            <div class="era-section">
                <div class="era-title">明代茶具</div>
                <div class="tea-ware-item">
                    <div class="ware-name">紫砂壶</div>
                    <div class="ware-detail">
                        <p>宜兴紫砂，适合泡散茶</p>
                        <div class="historical-source">《阳羡茗壶系》："壶经久用，涤拭日加，自发黯然之光，入手可鉴。"</div>
                    </div>
                </div>
                <div class="tea-ware-item">
                    <div class="ware-name">青花盖碗</div>
                    <div class="ware-detail">
                        <p>景德镇瓷器，泡茶品饮</p>
                        <div class="historical-source">《陶说》："景德镇窑，宋景德年间烧造，土白壤而埴，质薄腻，色滋润。"</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 添加文献查询面板 -->
        <div class="literature-panel">
            <h3>古籍文献查询</h3>
            <div class="search-box">
                <input type="text" id="literature-search" placeholder="输入关键词搜索文献...">
                <button id="search-btn">搜索</button>
            </div>
            <div class="literature-list">
                <div class="literature-item" data-keywords="茶经 陆羽 唐代">
                    <div class="literature-title">《茶经》</div>
                    <div class="literature-info">
                        <p>作者：陆羽</p>
                        <p>年代：唐代</p>
                        <p>主要内容：系统论述茶叶生产、加工、饮用等</p>
                    </div>
                    <div class="literature-quote">
                        <p>"茶之为饮，发乎神农氏，闻于鲁周公。"</p>
                    </div>
                </div>
                <div class="literature-item" data-keywords="大观茶论 宋徽宗 宋代">
                    <div class="literature-title">《大观茶论》</div>
                    <div class="literature-info">
                        <p>作者：宋徽宗</p>
                        <p>年代：宋代</p>
                        <p>主要内容：论述宋代点茶技艺</p>
                    </div>
                    <div class="literature-quote">
                        <p>"茶之为物，擅瓯闽之秀气，钟山川之灵禀。"</p>
                    </div>
                </div>
                <div class="literature-item" data-keywords="茶录 蔡襄 宋代">
                    <div class="literature-title">《茶录》</div>
                    <div class="literature-info">
                        <p>作者：蔡襄</p>
                        <p>年代：宋代</p>
                        <p>主要内容：记录宋代茶事</p>
                    </div>
                    <div class="literature-quote">
                        <p>"茶色贵白，而饼茶多以珍膏油其面，故有青黄紫黑之异。"</p>
                    </div>
                </div>
                <div class="literature-item" data-keywords="阳羡茗壶系 周高起 明代">
                    <div class="literature-title">《阳羡茗壶系》</div>
                    <div class="literature-info">
                        <p>作者：周高起</p>
                        <p>年代：明代</p>
                        <p>主要内容：论述紫砂壶制作</p>
                    </div>
                    <div class="literature-quote">
                        <p>"壶经久用，涤拭日加，自发黯然之光，入手可鉴。"</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tea-horse-trade">
        <h2>茶马互市与民族交往</h2>
        <div class="trade-container">
            <div class="trade-map">
                <div class="trade-route">
                    <div class="route-title">茶马古道</div>
                    <div class="route-path">
                        <div class="node" data-info="茶叶产地，贸易起点">云南</div>
                        <div class="arrow">→</div>
                        <div class="node" data-info="重要中转站，民族聚居地">大理</div>
                        <div class="arrow">→</div>
                        <div class="node" data-info="藏族聚居区，马匹产地">西藏</div>
                        <div class="arrow">→</div>
                        <div class="node" data-info="贸易终点，连接中亚">青海</div>
                    </div>
                </div>
            </div>

            <div class="trade-history">
                <div class="history-item">
                    <div class="era">唐代</div>
                    <div class="content">
                        <p>设立茶马司，开始官方茶马贸易</p>
                        <div class="source">《新唐书·食货志》："贞元中，吐蕃请茶，诏许之。"</div>
                    </div>
                </div>
                <div class="history-item">
                    <div class="era">宋代</div>
                    <div class="content">
                        <p>茶马互市制度完善，设立榷场</p>
                        <div class="source">《宋史·食货志》："凡茶之利，官得其七，商得其三。"</div>
                    </div>
                </div>
                <div class="history-item">
                    <div class="era">明代</div>
                    <div class="content">
                        <p>茶马贸易达到鼎盛，形成固定路线</p>
                        <div class="source">《明史·食货志》："茶马之政，所以驭番夷，制边陲。"</div>
                    </div>
                </div>
            </div>

            <div class="cultural-exchange">
                <h3>文化交流</h3>
                <div class="exchange-items">
                    <div class="exchange-item">
                        <div class="title">茶马古道</div>
                        <div class="description">
                            <p>连接汉藏文化的重要通道</p>
                            <p>促进民族融合与文化交流</p>
                        </div>
                    </div>
                    <div class="exchange-item">
                        <div class="title">贸易往来</div>
                        <div class="description">
                            <p>茶叶换取马匹，互通有无</p>
                            <p>形成稳定的经济联系</p>
                        </div>
                    </div>
                    <div class="exchange-item">
                        <div class="title">文化融合</div>
                        <div class="description">
                            <p>茶文化传播到少数民族地区</p>
                            <p>形成独特的饮茶习俗</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.spread-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background: linear-gradient(135deg, #f9f7f0 0%, #e8e6d9 100%);
}

.page-header {
    text-align: center;
    margin-bottom: 40px;
}

.page-header h1 {
    color: #8B4513;
    font-family: 'Calligraphy';
    font-size: 32px;
    margin-bottom: 10px;
}

.period {
    color: #666;
    font-size: 18px;
}

.historical-context {
    background: white;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 40px;
    box-shadow: 0 4px 20px rgba(139, 69, 19, 0.1);
}

.timeline-container {
    background: white;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 30px;
    box-shadow: 0 4px 20px rgba(139, 69, 19, 0.1);
}

.timeline {
    position: relative;
    padding: 20px 0;
}

.timeline-item {
    display: flex;
    margin-bottom: 30px;
    position: relative;
}

.timeline-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(45deg, #8B4513, #D2B48C);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Calligraphy';
    font-size: 24px;
    margin-right: 20px;
    flex-shrink: 0;
}

.timeline-content {
    background: #f9f7f0;
    padding: 20px;
    border-radius: 8px;
    flex-grow: 1;
    border: 1px solid #D2B48C;
}

.timeline-content h3 {
    color: #8B4513;
    font-family: 'Calligraphy';
    margin-bottom: 10px;
}

.timeline-content p {
    color: #666;
    margin-bottom: 10px;
}

.historical-detail {
    background: rgba(139, 69, 19, 0.05);
    padding: 10px;
    border-radius: 4px;
    border-left: 3px solid #8B4513;
    margin-top: 10px;
}

.historical-detail p {
    color: #8B4513;
    font-style: italic;
    margin: 0;
}

.price-history {
    background: white;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 30px;
    box-shadow: 0 4px 20px rgba(139, 69, 19, 0.1);
}

.price-chart {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.price-item {
    flex: 1;
    background: #f9f7f0;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #D2B48C;
}

.era {
    color: #8B4513;
    font-family: 'Calligraphy';
    font-size: 24px;
    text-align: center;
    margin-bottom: 15px;
}

.price-info {
    color: #666;
    margin-bottom: 15px;
}

.source {
    color: #8B4513;
    font-size: 14px;
    text-align: right;
    font-style: italic;
}

.route-map {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(139, 69, 19, 0.1);
    margin-bottom: 40px;
}

.route-container {
    display: flex;
    flex-direction: column;
    gap: 30px;
}

.route-item {
    padding: 20px;
    border-radius: 8px;
}

.route-item h3 {
    color: #8B4513;
    font-family: 'Calligraphy';
    margin-bottom: 20px;
    text-align: center;
}

.route-path {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    position: relative;
}

.node {
    background: #f9f7f0;
    padding: 10px 20px;
    border-radius: 20px;
    border: 2px solid #D2B48C;
    color: #8B4513;
    font-weight: bold;
    min-width: 80px;
    text-align: center;
    position: relative;
    cursor: pointer;
}

.arrow {
    color: #8B4513;
    font-size: 20px;
    font-weight: bold;
}

.route-item.land {
    background: linear-gradient(135deg, #f9f7f0 0%, #e8e6d9 100%);
    border: 2px solid #D2B48C;
}

.route-item.sea {
    background: linear-gradient(135deg, #e8e6d9 0%, #f9f7f0 100%);
    border: 2px solid #8B4513;
}

.route-item.east {
    background: linear-gradient(135deg, #f9f7f0 0%, #e8e6d9 100%);
    border: 2px solid #A0522D;
}

.node::after {
    content: attr(data-info);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #D2B48C;
    border-radius: 8px;
    color: #8B4513;
    font-size: 14px;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 100;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.node:hover::after {
    opacity: 1;
}

.route-path::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    transition: background 0.3s;
}

.route-path:hover::before {
    background: rgba(255, 255, 255, 0.2);
}

.tea-ware-evolution {
    background: white;
    padding: 30px;
    border-radius: 10px;
    margin: 30px 0;
    box-shadow: 0 4px 20px rgba(139, 69, 19, 0.1);
}

.tea-ware-evolution h2 {
    color: #8B4513;
    font-family: 'Calligraphy';
    text-align: center;
    margin-bottom: 30px;
    font-size: 28px;
}

.evolution-container {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.era-section {
    flex: 1;
    background: #f9f7f0;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #D2B48C;
}

.era-title {
    color: #8B4513;
    font-family: 'Calligraphy';
    font-size: 24px;
    text-align: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #D2B48C;
}

.tea-ware-item {
    margin-bottom: 20px;
    padding: 15px;
    background: white;
    border-radius: 6px;
    border: 1px solid #D2B48C;
}

.ware-name {
    color: #8B4513;
    font-family: 'Calligraphy';
    font-size: 18px;
    margin-bottom: 10px;
}

.ware-detail {
    color: #666;
    font-size: 14px;
    line-height: 1.6;
}

.historical-source {
    margin-top: 10px;
    padding: 8px;
    background: rgba(139, 69, 19, 0.05);
    border-radius: 4px;
    border-left: 3px solid #8B4513;
    color: #8B4513;
    font-style: italic;
    font-size: 12px;
}

.era-section {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.5s ease;
}

.era-section.visible {
    opacity: 1;
    transform: translateY(0);
}

.tea-ware-item {
    opacity: 0;
    transform: translateX(-20px);
    transition: all 0.5s ease;
}

.tea-ware-item.visible {
    opacity: 1;
    transform: translateX(0);
}

/* 添加文献查询面板样式 */
.literature-panel {
    margin-top: 40px;
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(139, 69, 19, 0.1);
}

.literature-panel h3 {
    color: #8B4513;
    font-family: 'Calligraphy';
    text-align: center;
    margin-bottom: 20px;
    font-size: 24px;
}

.search-box {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

#literature-search {
    flex: 1;
    padding: 10px 15px;
    border: 2px solid #D2B48C;
    border-radius: 5px;
    font-size: 16px;
    color: #8B4513;
}

#search-btn {
    padding: 10px 20px;
    background: #8B4513;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-family: 'Calligraphy';
    transition: background 0.3s;
}

#search-btn:hover {
    background: #A0522D;
}

.literature-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.literature-item {
    background: #f9f7f0;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #D2B48C;
    transition: transform 0.3s, box-shadow 0.3s;
}

.literature-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(139, 69, 19, 0.2);
}

.literature-title {
    color: #8B4513;
    font-family: 'Calligraphy';
    font-size: 20px;
    margin-bottom: 10px;
    text-align: center;
}

.literature-info {
    color: #666;
    margin-bottom: 15px;
    line-height: 1.6;
}

.literature-quote {
    padding: 10px;
    background: rgba(139, 69, 19, 0.05);
    border-radius: 4px;
    border-left: 3px solid #8B4513;
}

.literature-quote p {
    color: #8B4513;
    font-style: italic;
    margin: 0;
    font-size: 14px;
}

/* 添加搜索高亮样式 */
.highlight {
    background: rgba(139, 69, 19, 0.1);
    border: 2px solid #8B4513;
}

/* 添加动画效果 */
.literature-item {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.5s ease;
}

.literature-item.visible {
    opacity: 1;
    transform: translateY(0);
}

/* 添加茶马互市样式 */
.tea-horse-trade {
    background: white;
    padding: 30px;
    border-radius: 10px;
    margin: 30px 0;
    box-shadow: 0 4px 20px rgba(139, 69, 19, 0.1);
}

.tea-horse-trade h2 {
    color: #8B4513;
    font-family: 'Calligraphy';
    text-align: center;
    margin-bottom: 30px;
    font-size: 28px;
}

.trade-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.trade-map {
    grid-column: 1 / -1;
    background: #f9f7f0;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #D2B48C;
}

.trade-route {
    text-align: center;
}

.route-title {
    color: #8B4513;
    font-family: 'Calligraphy';
    font-size: 24px;
    margin-bottom: 20px;
}

.route-path {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 15px;
}

.route-path .node {
    background: white;
    padding: 10px 20px;
    border-radius: 20px;
    border: 2px solid #D2B48C;
    color: #8B4513;
    font-weight: bold;
    position: relative;
    cursor: pointer;
}

.route-path .arrow {
    color: #8B4513;
    font-size: 20px;
    font-weight: bold;
}

.trade-history {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.history-item {
    background: #f9f7f0;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #D2B48C;
}

.history-item .era {
    color: #8B4513;
    font-family: 'Calligraphy';
    font-size: 20px;
    margin-bottom: 10px;
}

.history-item .content {
    color: #666;
    line-height: 1.6;
}

.history-item .source {
    margin-top: 10px;
    padding: 8px;
    background: rgba(139, 69, 19, 0.05);
    border-radius: 4px;
    border-left: 3px solid #8B4513;
    color: #8B4513;
    font-style: italic;
    font-size: 12px;
}

.cultural-exchange {
    background: #f9f7f0;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #D2B48C;
}

.cultural-exchange h3 {
    color: #8B4513;
    font-family: 'Calligraphy';
    text-align: center;
    margin-bottom: 20px;
    font-size: 22px;
}

.exchange-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.exchange-item {
    background: white;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #D2B48C;
}

.exchange-item .title {
    color: #8B4513;
    font-family: 'Calligraphy';
    font-size: 18px;
    margin-bottom: 10px;
    text-align: center;
}

.exchange-item .description {
    color: #666;
    font-size: 14px;
    line-height: 1.6;
}

/* 添加动画效果 */
.history-item, .exchange-item {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.5s ease;
}

.history-item.visible, .exchange-item.visible {
    opacity: 1;
    transform: translateY(0);
}

.route-path .node {
    opacity: 0;
    transform: translateX(-20px);
    transition: all 0.5s ease;
}

.route-path .node.visible {
    opacity: 1;
    transform: translateX(0);
}

/* 添加数据源样式 */
.data-source {
    color: #666;
    font-size: 14px;
    font-style: italic;
    text-align: center;
    margin-top: 5px;
}

/* 优化路线信息样式 */
.route-info {
    margin-top: 15px;
    padding: 10px;
    background: rgba(139, 69, 19, 0.05);
    border-radius: 4px;
    border-left: 3px solid #8B4513;
}

.route-info p {
    color: #666;
    font-size: 14px;
    margin: 5px 0;
    line-height: 1.4;
}

/* 添加响应式布局 */
@media (max-width: 768px) {
    .route-container {
        flex-direction: column;
    }
    
    .route-path {
        flex-wrap: wrap;
    }
    
    .node {
        margin: 5px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log("文化传播界面脚本已加载");
    
    // 初始化所有元素显示
    document.querySelectorAll('.timeline-item, .price-item, .node, .literature-item, .history-item, .exchange-item, .tea-ware-item, .era-section').forEach(item => {
        item.classList.add('visible');
        item.style.opacity = '1';
        item.style.transform = 'translateY(0)';
    });

    // 保持原有交互效果
    const nodes = document.querySelectorAll('.node');
    nodes.forEach(node => {
        node.addEventListener('click', function() {
            this.classList.toggle('active');
        });
    });

    const routes = document.querySelectorAll('.route-item');
    routes.forEach(route => {
        const routeInfo = route.querySelector('.route-info');
        if (routeInfo) {
            routeInfo.style.display = 'none';
            
            route.addEventListener('click', function() {
                routeInfo.style.display = routeInfo.style.display === 'none' ? 'block' : 'none';
            });
        }
        
        route.addEventListener('mouseenter', function() {
            this.classList.add('highlight');
        });
        route.addEventListener('mouseleave', function() {
            this.classList.remove('highlight');
        });
    });

    // 添加文献搜索功能
    const searchInput = document.getElementById('literature-search');
    const searchBtn = document.getElementById('search-btn');
    
    if (searchInput && searchBtn) {
        const literatureItems = document.querySelectorAll('.literature-item');
        
        function performSearch() {
            console.log("执行搜索");
            const searchTerm = searchInput.value.toLowerCase();
            
            literatureItems.forEach(item => {
                const keywords = item.dataset.keywords.toLowerCase();
                const title = item.querySelector('.literature-title').textContent.toLowerCase();
                const info = item.querySelector('.literature-info').textContent.toLowerCase();
                const quote = item.querySelector('.literature-quote').textContent.toLowerCase();
                
                if (searchTerm === '' || 
                    keywords.includes(searchTerm) || 
                    title.includes(searchTerm) || 
                    info.includes(searchTerm) || 
                    quote.includes(searchTerm)) {
                    item.style.display = 'block';
                    item.classList.add('highlight');
                } else {
                    item.style.display = 'none';
                    item.classList.remove('highlight');
                }
            });
        }
        
        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    } else {
        console.error("未找到文献搜索元素");
    }

    // 添加节点悬停效果
    const routeNodes = document.querySelectorAll('.route-path .node');
    routeNodes.forEach(node => {
        node.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1)';
            this.style.boxShadow = '0 5px 15px rgba(139, 69, 19, 0.2)';
        });
        
        node.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
            this.style.boxShadow = 'none';
        });
    });
});
</script>
{% endblock %}