{% extends "base.html" %}

{% block content %}
<div class="historical-price">
    <div class="chart-container">
        <div id="priceChart" style="width: 800px;height:500px;"></div>
    </div>

    <div class="historical-context">
        <h2>历代茶政要录</h2>
        <div class="timeline">
            {% for item in price_data %}
            <div class="timeline-item">
                <div class="timeline-icon">{{ item.year }}</div>
                <div class="timeline-content">
                    <h3>{{ item.dynasty }} - {{ item.tea_type }}</h3>
                    <p class="price">官价：{{ item.price_liang }}两/斤</p>
                    <p class="source">出处：《{{ item.source }}》</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    var priceData = {{ price_data|tojson }};

    var chart = echarts.init(document.getElementById('priceChart'));
    var option = {
        title: {
            text: '历代茶叶官价变化（唐-清）',
            textStyle: { fontFamily: 'Calligraphy' }
        },
        tooltip: {
            formatter: function(params) {
                return `${params.data.dynasty} ${params.data.year}年<br>
                ${params.data.tea_type}<br>
                官价：${params.data.price_liang}两/斤<br>
                出处：${params.data.source}`;
            }
        },
        xAxis: {
            type: 'category',
            data: priceData.map(d => d.year),
            axisLabel: { 
                rotate: 45,
                fontFamily: 'Calligraphy'
            }
        },
        yAxis: { 
            type: 'value', 
            name: '价格（两/斤）',
            nameTextStyle: {
                fontFamily: 'Calligraphy'
            }
        },
        series: [{
            data: priceData.map(d => ({
                value: d.price_liang,
                dynasty: d.dynasty,
                year: d.year,
                tea_type: d.tea_type,
                source: d.source
            })),
            type: 'line',
            smooth: true,
            lineStyle: { color: '#4a6144', width: 3 },
            symbol: 'circle',
            symbolSize: 10,
            itemStyle: {
                color: '#7b8d6d'
            }
        }]
    };
    chart.setOption(option);
</script>
{% endblock %}