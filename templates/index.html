{% extends "base.html" %}

{% block content %}
<div class="historical-price">
    <div class="content-section chart-container">
        <div id="priceChart" style="width: 100%; height: 600px;"></div>
    </div>

    <!-- 砖块布局 -->
    <div class="content-section historical-context">
        <h2>历代茶政要录</h2>
        <div class="brick-container" id="brick-container">
            <!-- 砖块布局将由JavaScript生成 -->
        </div>
        <div class="detail-card" id="detail-card">
            <div class="card-content">
                <span class="close-btn">&times;</span>
                <h3 class="detail-title">点击时间砖块查看详情</h3>
                <div class="detail-body"></div>
            </div>
        </div>
    </div>
</div>

<style>
.historical-price {
    display: flex;
    flex-direction: column;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px 0; /* 移除左右padding */
}

.content-section {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
    width: 100%;
    box-sizing: border-box;
    max-width: 1200px; /* 新增最大宽度限制 */
    margin-left: auto; /* 新增居中 */
    margin-right: auto; /* 新增居中 */
}

/* 分别为上下部分设置不同的padding */
.chart-container {
    padding: 20px;
    width: 100%;
    box-sizing: border-box;
}

.historical-context {
    position: relative;
    padding: 20px 0 0 0; /* 只保留顶部padding，移除左右和底部padding */
    width: 100%;
    box-sizing: border-box; /* 确保padding不影响实际宽度 */
}

.historical-context h2 {
    color: #8B4513;
    font-family: '衡山毛笔行书', 'Calligraphy';
    text-align: left;
    font-size: 20px;
    margin: 0 20px 20px; /* 使用margin代替padding，保持内容对齐 */
    padding-bottom: 10px;
    border-bottom: 1px solid #D2B48C; /* 减小底部边框厚度 */
}

/* 砖块布局样式 */
.brick-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 100%;
    margin: 0 auto;
    padding: 0 20px 20px;
    max-width: 1160px; /* 新增最大宽度限制 */
}

.dynasty-row {
    display: flex;
    width: 100%;
    gap: 15px;
    margin-bottom: 30px; /* 增加行间距 */
    flex-wrap: nowrap; /* 防止换行 */
}

/* 给最后一行取消底部间距 */
.dynasty-row:last-child {
    margin-bottom: 0;
}

.dynasty-label {
    font-family: '衡山毛笔行书', 'Calligraphy';
    font-size: 22px;
    color: #8B4513;
    text-align: left; /* 左对齐与砖块对齐 */
    margin-bottom: 15px;
    padding-bottom: 5px;
    border-bottom: 1px solid #D2B48C; /* 减小底部边框厚度 */
    width: 100%; /* 确保标签占满整行 */
}

.tea-brick {
    flex: 1;
    min-width: 0; /* 允许flex项目缩小到小于内容宽度 */
    height: 120px;
    background: linear-gradient(45deg, #D2B48C, #E6D2B5);
    border-radius: 8px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s, box-shadow 0.3s;
    position: relative;
    overflow: hidden;
}

.tea-brick:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.tea-brick.active {
    background: linear-gradient(45deg, #7b8d6d, #a8c0a0);
    color: white;
}

.tea-brick .tea-type {
    font-family: '衡山毛笔行书', 'Calligraphy';
    font-size: 18px;
    font-weight: bold;
    color: #8B4513;
    margin-bottom: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.tea-brick.active .tea-type {
    color: white;
}

.tea-brick .dynasty {
    font-size: 16px;
    color: #4A6144;
    margin-bottom: 5px;
}

.tea-brick.active .dynasty {
    color: #f0f0f0;
}

.tea-brick .year {
    font-size: 14px;
    color: #666;
}

.tea-brick.active .year {
    color: #f0f0f0;
}

.tea-brick .price {
    font-size: 14px;
    color: #666;
    margin-top: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.tea-brick.active .price {
    color: #f0f0f0;
}

/* 详情卡片 */
.detail-card {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80%;
    max-width: 800px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    padding: 25px;
    z-index: 100;
    display: none;
    max-height: 80vh;
    overflow-y: auto;
}

.detail-card.show {
    display: block;
    animation: fadeIn 0.3s ease-in-out forwards;
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    color: #8B4513;
    cursor: pointer;
    transition: color 0.3s;
}

.close-btn:hover {
    color: #A52A2A;
}

.detail-title {
    color: #8B4513;
    font-family: '衡山毛笔行书', 'Calligraphy';
    margin-bottom: 15px;
    text-align: center;
    padding-bottom: 10px;
    border-bottom: 1px solid #D2B48C;
}

.detail-body {
    display: flex;
    flex-wrap: wrap;
}

.detail-section {
    flex: 1 1 300px;
    padding: 10px;
    margin: 5px;
}

.detail-section h4 {
    color: #8B4513;
    margin-bottom: 10px;
    font-family: '衡山毛笔行书', 'Calligraphy';
}

.detail-section p {
    color: #666;
    line-height: 1.6;
    margin-bottom: 10px;
}

.price-info {
    background: #f9f7f0;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 10px;
}

.price-info span {
    color: #4A6144;
    font-weight: bold;
}

/* 模态框背景 */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 99;
    display: none;
}

.modal-overlay.show {
    display: block;
}

/* 动画 */
@keyframes fadeIn {
    from { opacity: 0; transform: translate(-50%, -40%); }
    to { opacity: 1; transform: translate(-50%, -50%); }
}

.fade-in {
    animation: fadeIn 0.3s ease-in-out forwards;
}
</style>

<script>
    // 历史背景信息函数
    function getHistoricalContext(year, dynasty) {
        const historyData = {
            '唐': {
                base: '唐代（618-907年）是中国茶文化繁荣发展的重要时期，陆羽《茶经》在此时问世，系统总结了唐代茶事。',
                '758': '此时正值唐玄宗晚期，茶已成为宫廷贡品，顾渚紫笋为贡茶之一。',
                '780': '此时为德宗时期，陆羽《茶经》已经完成，阳羡茶为当时高品质茶叶。',
                '805': '唐宪宗年间，茶税开始成为政府重要财政来源。',
                '850': '唐宣宗时期，制茶技术已相当成熟，蜀地茶园广泛建立。'
            },
            '宋': {
                base: '宋代（960-1279年）是中国茶文化的黄金时期，点茶法盛行，团茶、散茶并举，并设立专门的茶产区。',
                '1020': '宋仁宗时期，茶已成为与盐、铁并重的国家专卖商品，建茗为当时名贵茶品。',
                '1068': '宋神宗年间，王安石变法期间，加强茶专卖制度，北苑贡茶价格昂贵。',
                '1106': '宋徽宗时期，龙团茶成为最高级贡茶，《大观茶论》问世。',
                '1162': '宋高宗时期，日铸茶为与金国贸易的重要物品。',
                '1200': '宋宁宗年间，南宋茶产业繁荣，密云茶为北方贸易重要商品。',
                '1265': '宋度宗时期，蒙古威胁下茶叶贸易仍然活跃，蒙顶茶价格较为稳定。'
            },
            '元': {
                base: '元代（1271-1368年）茶叶贸易由官营转向民营，茶马贸易成为通行制度。',
                '1320': '元英宗时期，松萝茶为宫廷贡茶，价格由于民营化有所下降。',
                '1368': '元朝末年，茶叶贸易秩序松动，峨眉雪芽价格波动较大。'
            },
            '明': {
                base: '明代（1368-1644年）是中国茶叶制作工艺发展的重要时期，炒青工艺取代蒸青，为中国茶叶加工史上的一次革命。',
                '1391': '明太祖朱元璋在位晚期，对茶叶征收严格税收，武夷岩茶成为贡茶。',
                '1424': '明仁宗时期，龙井茶已是名茶，官定价格较高。',
                '1462': '明英宗时期，安溪铁观音开始名声鹊起。',
                '1505': '明武宗时期，碧螺春价格因品质精良而昂贵。',
                '1563': '明世宗晚期，黄山毛峰茶叶品质提升。',
                '1602': '明神宗时期，茶叶外销兴盛，洞庭碧螺春为贡茶。',
                '1636': '明崇祯末年，动荡局势下祁门红茶价格相对稳定。'
            },
            '清': {
                base: '清代（1644-1911年）茶叶生产呈现全面繁荣局面，茶叶品种多样化，并开始大量外销欧美。',
                '1670': '康熙初期，普洱茶因运输困难价格适中。',
                '1723': '雍正初年，六安瓜片为宫廷贡茶之一。',
                '1756': '乾隆盛世，蒙顶甘露作为高档贡茶价格昂贵。',
                '1801': '嘉庆时期，信阳毛尖品质优良，官定价格较高。',
                '1845': '道光晚期，君山银针产量稀少，价格高昂。',
                '1872': '同治末年，都匀毛尖成为贵州著名茶品。',
                '1895': '光绪中期，福鼎白茶因特殊工艺和药用价值，官价较高。'
            }
        };

        // 获取特定年份的历史背景，如果没有则返回朝代基本信息
        return historyData[dynasty][year] || historyData[dynasty]['base'] || `${dynasty}（${year}年）茶叶贸易活跃，各地茶叶均有详细价格记载。`;
    }

    // 茶叶描述函数
    function getTeaDescription(teaType) {
        const teaData = {
            '顾渚紫笋': '产于浙江长兴顾渚山，紫笋为芽茶，色泽紫绿，形如笋尖，味道清爽，唐代名茶之一。',
            '阳羡茶': '产于江苏宜兴阳羡一带，芽叶肥壮，汤色碧绿，香气高雅，为陆羽所推崇的名茶。',
            '贡茶': '专供皇室使用的茶叶，品质极高，多采自名山，制作精良，口感上乘。',
            '蜀茶': '四川茶叶总称，芽叶肥厚，香气浓郁，耐泡度高，唐代已闻名全国。',
            '建茗': '福建建州（今建瓯）所产茶叶，为宋代贡茶代表，制成龙凤团茶，香气馥郁。',
            '北苑贡茶': '产自福建建州北苑，为宋代最高级贡茶，色泽乌润，香气清高，滋味甘醇。',
            '龙团茶': '宋徽宗时期贡茶，产自福建，压制成龙形团块，内质香醇，茶性温和。',
            '日铸茶': '宋代名茶，每日新制，故名"日铸"，品质上乘，常作为外交礼品。',
            '密云茶': '产自北方，叶片肥厚，耐寒性强，宋代北方流通的主要茶品。',
            '蒙顶茶': '产自四川蒙山，属绿茶类，清香持久，滋味甘醇，始创于周代，历代为贡品。',
            '松萝茶': '原产自湖南，属于黄茶类，滋味醇和，元代宫廷珍品。',
            '峨眉雪芽': '产自四川峨眉山，芽头银白如雪，故名雪芽，口感鲜爽，香气持久。',
            '武夷岩茶': '产自福建武夷山，属乌龙茶类，岩韵明显，香气高锐持久，滋味醇厚。',
            '龙井茶': '产自浙江杭州西湖，扁平光滑，色泽嫩绿，香郁味甘，唐代已负盛名。',
            '安溪铁观音': '产自福建安溪，属乌龙茶，香气馥郁持久，滋味醇厚回甘，明代始创。',
            '碧螺春': '产自江苏苏州洞庭山，芽叶细嫩，白毫显露，形似螺旋，清香持久。',
            '黄山毛峰': '产自安徽黄山，外形似雀舌，色泽翠绿，香气如兰，滋味甘醇。',
            '洞庭碧螺春': '产自江苏洞庭山，芽身细圆，有白毫，清香持久，甘醇爽口。',
            '祁门红茶': '产自安徽祁门，形细而紧，色泽乌润，香气馥郁似兰花香，滋味醇厚。',
            '普洱茶': '产自云南普洱地区，可长期存放，越陈越香，具有独特的陈香，滋味醇厚回甘。',
            '六安瓜片': '产自安徽六安，精选单片嫩叶，不含芽和梗，形似瓜子，滋味鲜爽。',
            '蒙顶甘露': '产自四川蒙山，芽头肥壮，覆白毫，汤色黄绿明亮，滋味甘醇爽口。',
            '信阳毛尖': '产自河南信阳，外形细直如针，满披白毫，香高持久，滋味鲜醇。',
            '君山银针': '产自湖南岳阳君山，属黄茶类，外形似针，满披白毫，汤色杏黄，滋味醇和。',
            '都匀毛尖': '产自贵州都匀，形如雀舌，色翠芽尖，白毫显露，香气高锐持久。',
            '福鼎白茶': '产自福建福鼎，采用自然萎凋工艺，不经杀青，满披白毫，滋味清甜，有药用价值。'
        };

        return teaData[teaType] || `${teaType}是中国传统名茶，具有独特的风味和品质特点。`;
    }

    // 产区信息函数
    function getProductionArea(teaType) {
        const areaData = {
            '顾渚紫笋': '产自浙江长兴顾渚山，海拔约500米，土壤肥沃，雨量充足，气候温和，适宜茶树生长。',
            '阳羡茶': '产自江苏宜兴阳羡（今宜兴市阳羡茶场一带），地处太湖流域，气候湿润，土壤为红壤，富含矿物质。',
            '贡茶': '贡茶产区多在名山，如浙江、福建、四川等地，这些地区多为山区，海拔适中，云雾环绕，昼夜温差大。',
            '蜀茶': '四川盆地及周边山区，地势高峻，气候温和湿润，土壤肥沃，是中国最早的产茶区之一。',
            '建茗': '产自福建建瓯北苑一带，山峦起伏，溪流纵横，云雾缭绕，气候温和湿润。',
            '北苑贡茶': '福建建州北苑（今建瓯市），地势较高，云雾常年环绕，昼夜温差大，土壤富含矿物质。',
            '龙团茶': '主产于福建建州一带，山地丘陵地形，气候温暖湿润，土壤以红黄壤为主。',
            '日铸茶': '多产自江南地区优质茶区，如浙江、福建等地，气候温和，雨量充沛。',
            '密云茶': '河北密云一带，属于北方茶区，气候较为寒冷，茶树品种适应性强。',
            '蒙顶茶': '四川蒙山，海拔约1000米，气候温和湿润，云雾弥漫，昼夜温差大，土壤肥沃。',
            '松萝茶': '湖南西部山区，海拔适中，气候温和，雨量充沛，土壤富含有机质。',
            '峨眉雪芽': '四川峨眉山，海拔约800-1200米，云雾环绕，气候温和湿润，水质清冽。',
            '武夷岩茶': '福建武夷山，生长于岩缝之中，海拔约500-800米，独特的"岩骨花香"与当地特殊的土壤和气候密切相关。',
            '龙井茶': '浙江杭州西湖龙井村一带，山环水绕，云雾缭绕，昼夜温差大，土壤为红壤，富含铁质。',
            '安溪铁观音': '福建安溪县西坪、虎邱等地，海拔约600-800米，气候温和，雨量充沛，土壤矿物质丰富。',
            '碧螺春': '江苏苏州洞庭山太湖沿岸，气候温和，雨量充沛，土壤肥沃，桃树与茶树间作。',
            '黄山毛峰': '安徽黄山一带，海拔约800米以上，云雾缭绕，气候温和湿润，土壤为黄壤，富含矿物质。',
            '洞庭碧螺春': '江苏苏州洞庭山东、西山地区，临近太湖，气候湿润，雨量充沛，土壤肥沃。',
            '祁门红茶': '安徽祁门县，山区丘陵地形，气候温和湿润，昼夜温差大，土壤为黄红壤。',
            '普洱茶': '云南西双版纳、普洱、临沧等地，地处亚热带，属古茶树原产地，树龄可达千年，气候温和湿润。',
            '六安瓜片': '安徽六安市金寨、霍山一带，山区地形，气候温和，雨量充沛，土壤肥沃。',
            '蒙顶甘露': '四川蒙山甘露寺一带，海拔约1000米，气候温润，云雾常年环绕，土壤肥沃。',
            '信阳毛尖': '河南信阳市浉河区、商城县等地，地处大别山北麓，气候温和，雨量充沛，土壤为红黄壤。',
            '君山银针': '湖南岳阳洞庭湖中的君山，四面环水，气候湿润，日照适宜，土壤富含矿物质。',
            '都匀毛尖': '贵州都匀市周边山区，海拔约1200米，气候温和湿润，云雾环绕，土壤为红壤，富含有机质。',
            '福鼎白茶': '福建福鼎市太姥山一带，临近东海，气候温和湿润，雨量充沛，土壤为红壤，富含矿物质。'
        };

        return areaData[teaType] || `${teaType}的传统产区拥有适合茶树生长的自然环境，包括适宜的海拔、温度、湿度和土壤条件。`;
    }

    var priceData = {{ price_data|tojson }};
    
    // 创建砖块布局
    function createBrickLayout() {
        const brickContainer = document.getElementById('brick-container');
        
        // 按朝代对数据进行分组
        const dynastyGroups = {};
        priceData.forEach(item => {
            if (!dynastyGroups[item.dynasty]) {
                dynastyGroups[item.dynasty] = [];
            }
            dynastyGroups[item.dynasty].push(item);
        });
        
        // 按朝代顺序排列：唐、宋、元、明、清
        const dynastyOrder = ['唐', '宋', '元', '明', '清'];
        
        // 为每个朝代创建砖块行
        dynastyOrder.forEach(dynasty => {
            if (dynastyGroups[dynasty] && dynastyGroups[dynasty].length > 0) {
                // 创建朝代标签
                const dynastyLabel = document.createElement('div');
                dynastyLabel.className = 'dynasty-label';
                dynastyLabel.textContent = dynasty + '代茶叶';
                brickContainer.appendChild(dynastyLabel);
                
                // 按年份排序
                const sortedItems = dynastyGroups[dynasty].sort((a, b) => parseInt(a.year) - parseInt(b.year));
                
                // 创建朝代行
                const row = document.createElement('div');
                row.className = 'dynasty-row';
                
                // 添加砖块
                sortedItems.forEach(item => {
                    const brick = createTeaBrick(item);
                    row.appendChild(brick);
                });
                
                brickContainer.appendChild(row);
            }
        });
        
        // 创建模态框背景
        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay';
        document.body.appendChild(overlay);
        
        // 点击模态框背景关闭详情
        overlay.addEventListener('click', closeDetailCard);
        
        // 设置关闭按钮事件
        document.querySelector('.close-btn').addEventListener('click', closeDetailCard);
    }
    
    // 创建茶砖块
    function createTeaBrick(item) {
        const brick = document.createElement('div');
        brick.className = 'tea-brick';
        brick.dataset.year = item.year;
        
        // 添加茶叶类型（现在是主要显示的内容）
        const teaType = document.createElement('div');
        teaType.className = 'tea-type';
        teaType.textContent = item.tea_type;
        teaType.title = item.tea_type; // 添加提示框，鼠标悬停时显示完整名称
        brick.appendChild(teaType);
        
        // 添加朝代（现在是次要显示的内容）
        const dynasty = document.createElement('div');
        dynasty.className = 'dynasty';
        dynasty.textContent = item.dynasty + '代';
        brick.appendChild(dynasty);
        
        // 添加年份
        const year = document.createElement('div');
        year.className = 'year';
        year.textContent = item.year + '年';
        brick.appendChild(year);
        
        // 添加价格
        const price = document.createElement('div');
        price.className = 'price';
        price.textContent = `官价: ${item.price_liang}两/斤`;
        brick.appendChild(price);
        
        // 添加点击事件
        brick.addEventListener('click', () => {
            // 移除所有活跃状态
            document.querySelectorAll('.tea-brick').forEach(b => {
                b.classList.remove('active');
            });
            
            // 设置当前砖块为活跃状态
            brick.classList.add('active');
            
            // 显示详情
            showDetailCard(item);
        });
        
        return brick;
    }
    
    // 显示详情卡片
    function showDetailCard(item) {
        const detailCard = document.getElementById('detail-card');
        const detailTitle = detailCard.querySelector('.detail-title');
        const detailBody = detailCard.querySelector('.detail-body');
        const overlay = document.querySelector('.modal-overlay');
        
        // 设置标题 - 调整标题顺序，茶叶名称在前，朝代在后
        detailTitle.textContent = `${item.tea_type} - ${item.dynasty}（${item.year}年）`;
        
        // 设置内容
        detailBody.innerHTML = `
            <div class="detail-section">
                <div class="price-info">
                    <p>官价：<span>${item.price_liang}两/斤</span></p>
                    <p>出处：《${item.source}》</p>
                </div>
                <h4>历史背景</h4>
                <p>${getHistoricalContext(item.year, item.dynasty)}</p>
            </div>
            <div class="detail-section">
                <h4>茶叶特点</h4>
                <p>${getTeaDescription(item.tea_type)}</p>
                <h4>产区信息</h4>
                <p>${getProductionArea(item.tea_type)}</p>
            </div>
        `;
        
        // 显示模态框和详情卡片
        overlay.classList.add('show');
        detailCard.classList.add('show');
    }
    
    // 关闭详情卡片
    function closeDetailCard() {
        const detailCard = document.getElementById('detail-card');
        const overlay = document.querySelector('.modal-overlay');
        
        // 移除所有活跃状态
        document.querySelectorAll('.tea-brick').forEach(brick => {
            brick.classList.remove('active');
        });
        
        // 隐藏模态框和详情卡片
        overlay.classList.remove('show');
        detailCard.classList.remove('show');
    }
    
    // 从图表点击跳转到相应砖块
    function highlightBrickByYear(year) {
        const bricks = document.querySelectorAll('.tea-brick');
        
        // 移除所有高亮
        bricks.forEach(brick => {
            brick.classList.remove('active');
        });
        
        // 找到对应年份的砖块并高亮
        const targetBrick = Array.from(bricks).find(brick => brick.dataset.year === year);
        if (targetBrick) {
            // 滚动到砖块位置
            targetBrick.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // 高亮砖块
            targetBrick.classList.add('active');
            
            // 找到对应的数据项
            const item = priceData.find(data => data.year === year);
            if (item) {
                showDetailCard(item);
            }
        }
    }

    // 价格图表
    var chart = echarts.init(document.getElementById('priceChart'));
    var option = {
        title: {
            text: '历代茶叶官价变化（唐-清）',
            textStyle: { fontFamily: "'衡山毛笔行书', 'Calligraphy', serif", color: '#8B4513' },
            left: 'left',  // 左对齐与下方内容保持一致
            top: 0,        // 调整顶部距离
            padding: [0, 0, 20, 0]  // 增加底部padding
        },
        tooltip: {
            trigger: 'axis',
            formatter: function(params) {
                var param = params[0];
                return `${param.data.dynasty} ${param.data.year}年<br>
                ${param.data.tea_type}<br>
                官价：${param.data.value}两/斤<br>
                出处：${param.data.source}`;
            }
        },
        grid: {
            left: 20,  // 使用像素值以便与下方内容完全对齐
            right: 20,
            bottom: '10%',
            top: 80,   // 为标题留出足够空间
            containLabel: true
        },
        xAxis: {
            type: 'category',
            data: priceData.map(d => d.year),
            axisLabel: { 
                rotate: 45,
                fontFamily: "'衡山毛笔行书', 'Calligraphy', serif",
                color: '#666'
            },
            axisLine: {
                lineStyle: {
                    color: '#D2B48C'
                }
            }
        },
        yAxis: { 
            type: 'value', 
            name: '价格（两/斤）',
            nameTextStyle: {
                fontFamily: "'衡山毛笔行书', 'Calligraphy', serif",
                color: '#666'
            },
            axisLine: {
                lineStyle: {
                    color: '#D2B48C'
                }
            },
            splitLine: {
                lineStyle: {
                    color: '#F1F1F1'
                }
            }
        },
        series: [{
            data: priceData.map(d => ({
                value: parseFloat(d.price_liang),
                dynasty: d.dynasty,
                year: d.year,
                tea_type: d.tea_type,
                source: d.source
            })),
            type: 'line',
            smooth: true,
            lineStyle: { color: '#8B4513', width: 3 },
            symbol: 'circle',
            symbolSize: 10,
            itemStyle: {
                color: '#D2B48C',
                borderColor: '#8B4513',
                borderWidth: 2
            },
            areaStyle: {
                color: {
                    type: 'linear',
                    x: 0,
                    y: 0,
                    x2: 0,
                    y2: 1,
                    colorStops: [{
                        offset: 0, color: 'rgba(210, 180, 140, 0.3)'
                    }, {
                        offset: 1, color: 'rgba(210, 180, 140, 0)'
                    }]
                }
            }
        }]
    };
    chart.setOption(option);
    
    // 图表点击事件
    chart.on('click', function(params) {
        highlightBrickByYear(params.name);
    });
    
    // 自适应大小
    window.addEventListener('resize', function() {
        chart.resize();
    });
    
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        // 创建砖块布局
        createBrickLayout();
    });
</script>
{% endblock %}